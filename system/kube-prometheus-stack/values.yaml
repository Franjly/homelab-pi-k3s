kube-prometheus-stack:
  ## Create default rules for monitoring the cluster
  ##
  defaultRules:
    create: true
    rules:
      alertmanager: true
      etcd: true
      configReloaders: true
      general: true
      k8s: true
      kubeApiserverAvailability: true
      kubeApiserverBurnrate: true
      kubeApiserverHistogram: true
      kubeApiserverSlos: true
      kubeControllerManager: true
      kubelet: true
      kubeProxy: true
      kubePrometheusGeneral: true
      kubePrometheusNodeRecording: true
      kubernetesApps: true
      kubernetesResources: true
      kubernetesStorage: true
      kubernetesSystem: true
      kubeScheduler: true
      kubeStateMetrics: true
      network: true
      node: true
      nodeExporterAlerting: true
      nodeExporterRecording: true
      prometheus: true
      prometheusOperator: true

  ## Configuration for alertmanager
  ## ref: https://prometheus.io/docs/alerting/alertmanager/
  ##
  alertmanager:
    enabled: true

    config:
      global:
        resolve_timeout: 5m
      inhibit_rules:
        - source_matchers:
            - 'severity = critical'
          target_matchers:
            - 'severity =~ warning|info'
          equal:
            - 'namespace'
            - 'alertname'
        - source_matchers:
            - 'severity = warning'
          target_matchers:
            - 'severity = info'
          equal:
            - 'namespace'
            - 'alertname'
        - source_matchers:
            - 'alertname = InfoInhibitor'
          target_matchers:
            - 'severity = info'
          equal:
            - 'namespace'
      route:
        group_by: ['namespace']
        group_wait: 30s
        group_interval: 5m
        repeat_interval: 12h
        receiver: 'discord_webhook'
        routes:
        - receiver: 'null'
          matchers:
            - alertname =~ "InfoInhibitor|Watchdog"
      receivers:
      - name: 'null'
      - name: 'discord_webhook'
        webhook_configs:
        - url: 'http://alertmanager-discord.monitoring-system.svc.cluster.local:9094'
      templates:
      - '/etc/alertmanager/config/*.tmpl'

    ingress:
      enabled: true

      ingressClassName: nginx

      annotations:
        cert-manager.io/cluster-issuer: letsencrypt-staging
        # kubernetes.io/tls-acme: "true"
        # hajimari.io/appName: AlertManager
        # hajimari.io/icon: chart-bar
      hosts:
        - alertmanager.local.tecno-fly.com
      paths:
        - /
      tls: 
        - secretName: alertmanager-tls
          hosts:
          - alertmanager.local.tecno-fly.com
    
    alertmanagerSpec:
      storage:
        volumeClaimTemplate:
          spec:
            storageClassName: longhorn
            resources:
              requests:
                storage: 50Gi

  grafana:
    enabled: true

    defaultDashboardsTimezone: Europe/Madrid

    adminUser: <path:pi-k3s/data/system/monitoring-system/grafana#admin-user>
    adminPassword: <path:pi-k3s/data/system/monitoring-system/grafana#admin-passwd>

    ingress:
      enabled: true

      ingressClassName: nginx

      annotations:
        cert-manager.io/cluster-issuer: letsencrypt-staging
        # kubernetes.io/tls-acme: "true"
        # hajimari.io/appName: Grafana
        # hajimari.io/icon: chart-bar
      hosts:
        - grafana.local.tecno-fly.com
      path: /
      tls:
        - secretName: grafana-tls
          hosts:
          - grafana.local.tecno-fly.com

    persistence:
      enabled: false
      storageClassName: longhorn
      size: 10Gi

    sidecar:
      dashboards:
        enabled: true
        label: grafana_dashboard
        labelValue: "1"
        folder: /tmp/dashboards

        ## Annotations for Grafana dashboard configmaps
        ##
        annotations:
          k8s-sidecar-target-directory: /tmp/dashboards/kubernetes

        multicluster:
          global:
            enabled: false
          etcd:
            enabled: false
        provider:
          allowUiUpdates: false
          foldersFromFilesStructure: true
          
      datasources:
        enabled: true
        defaultDatasourceEnabled: true

        uid: prometheus

        ## URL of prometheus datasource
        ##
        # url: http://prometheus-stack-prometheus:9090/

        # If not defined, will use prometheus.prometheusSpec.scrapeInterval or its default
        # defaultDatasourceScrapeInterval: 15s

        ## Annotations for Grafana datasource configmaps
        ##
        annotations: {}

        ## Create datasource for each Pod of Prometheus StatefulSet;
        ## this uses headless service `prometheus-operated` which is
        ## created by Prometheus Operator
        ## ref: https://github.com/prometheus-operator/prometheus-operator/blob/0fee93e12dc7c2ea1218f19ae25ec6b893460590/pkg/prometheus/statefulset.go#L255-L286
        createPrometheusReplicasDatasources: false
        label: grafana_datasource
        labelValue: "1"

        ## Field with internal link pointing to existing data source in Grafana.
        ## Can be provisioned via additionalDataSources
        exemplarTraceIdDestinations: {}
          # datasourceUid: Jaeger
          # traceIdLabelName: trace_id

    plugins:
      - grafana-piechart-panel

    extraConfigmapMounts: []
    # - name: certs-configmap
    #   mountPath: /etc/grafana/ssl/
    #   configMap: certs-configmap
    #   readOnly: true

    deleteDatasources: []
    # - name: example-datasource
    #   orgId: 1

    ## Configure additional grafana datasources (passed through tpl)
    ## ref: http://docs.grafana.org/administration/provisioning/#datasources
    additionalDataSources:
      - name: Loki
        type: loki
        uid: loki
        url: http://loki.monitoring-system:3100
        isDefault: false

    # envFromSecret: grafana-secrets

    ## Configure grafana dashboard providers
    ## ref: http://docs.grafana.org/administration/provisioning/#dashboards
    ##
    ## `path` must be /var/lib/grafana/dashboards/<provider_name>
    ##
    dashboardProviders: 
      dashboardproviders.yaml:
        apiVersion: 1
        providers:
        - name: 'loki'
          orgId: 1
          folder: 'Loki'
          type: file
          disableDeletion: true
          editable: true
          options:
            path: /var/lib/grafana/dashboards/loki
        - name: 'unifi-poller'
          orgId: 1
          folder: 'UniFi-Poller'
          type: file
          disableDeletion: true
          editable: true
          options:
            path: /var/lib/grafana/dashboards/unifi-poller
        - name: 'ingress-nginx'
          orgId: 1
          folder: 'NGINX Ingress'
          type: file
          disableDeletion: true
          editable: true
          options:
            path: /var/lib/grafana/dashboards/ingress-nginx
        - name: 'pi-hole'
          orgId: 1
          folder: 'Pi-hole'
          type: file
          disableDeletion: true
          editable: true
          options:
            path: /var/lib/grafana/dashboards/pi-hole
        - name: 'calico'
          orgId: 1
          folder: 'Calico'
          type: file
          disableDeletion: true
          editable: true
          options:
            path: /var/lib/grafana/dashboards/calico
        - name: 'cert-manager'
          orgId: 1
          folder: 'Cert-Manager'
          type: file
          disableDeletion: true
          editable: true
          options:
            path: /var/lib/grafana/dashboards/cert-manager
        - name: 'longhorn'
          orgId: 1
          folder: 'Longhorn'
          type: file
          disableDeletion: true
          editable: true
          options:
            path: /var/lib/grafana/dashboards/longhorn
        - name: 'velero'
          orgId: 1
          folder: 'Velero'
          type: file
          disableDeletion: true
          editable: true
          options:
            path: /var/lib/grafana/dashboards/velero

    ## Configure grafana dashboard to import
    ## NOTE: To use dashboards you must also enable/configure dashboardProviders
    ## ref: https://grafana.com/dashboards
    ##
    ## dashboards per provider, use provider name as key.
    ##
    dashboards:
      loki:
        loki-dashboard:
          json: |
            {"annotations":{"list":[{"$$hashKey":"object:75","builtIn":1,"datasource":"-- Grafana --","enable":true,"hide":true,"iconColor":"rgba(0, 211, 255, 1)","name":"Annotations & Alerts","target":{"limit":100,"matchAny":false,"tags":[],"type":"dashboard"},"type":"dashboard"}]},"description":"Loki logs panel with prometheus variables ","editable":true,"fiscalYearStartMonth":0,"gnetId":12019,"graphTooltip":0,"iteration":1644880408496,"links":[],"liveNow":false,"panels":[{"aliasColors":{},"bars":true,"dashLength":10,"dashes":false,"datasource":{"type":"loki","uid":"loki"},"fieldConfig":{"defaults":{"links":[]},"overrides":[]},"fill":1,"fillGradient":0,"gridPos":{"h":3,"w":24,"x":0,"y":0},"hiddenSeries":false,"id":6,"legend":{"avg":false,"current":false,"max":false,"min":false,"show":false,"total":false,"values":false},"lines":false,"linewidth":1,"nullPointMode":"null","options":{"alertThreshold":true},"percentage":false,"pluginVersion":"8.3.5","pointradius":2,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"sum(count_over_time({namespace=\"$namespace\", pod=~\"$pod\"} |~ \"$search\"[$__interval]))","refId":"A"}],"thresholds":[],"timeRegions":[],"tooltip":{"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"mode":"time","show":true,"values":[]},"yaxes":[{"$$hashKey":"object:168","format":"short","logBase":1,"show":false},{"$$hashKey":"object:169","format":"short","logBase":1,"show":false}],"yaxis":{"align":false}},{"datasource":{"type":"loki","uid":"loki"},"gridPos":{"h":28,"w":24,"x":0,"y":3},"id":2,"maxDataPoints":"","options":{"dedupStrategy":"none","enableLogDetails":true,"prettifyLogMessage":false,"showCommonLabels":false,"showLabels":false,"showTime":true,"sortOrder":"Descending","wrapLogMessage":true},"targets":[{"expr":"{namespace=\"$namespace\", pod=~\"$pod\"} |~ \"$search\"","refId":"A"}],"title":"Logs Panel","type":"logs"}],"schemaVersion":34,"style":"dark","tags":[],"templating":{"list":[{"current":{"selected":true,"text":"monitoring","value":"monitoring"},"datasource":{"type":"prometheus","uid":"prometheus"},"definition":"label_values(kube_pod_info, namespace)","hide":0,"includeAll":false,"multi":false,"name":"namespace","options":[],"query":{"query":"label_values(kube_pod_info, namespace)","refId":"Prometheus-namespace-Variable-Query"},"refresh":1,"regex":"","skipUrlSync":false,"sort":0,"tagValuesQuery":"","tagsQuery":"","type":"query","useTags":false},{"allValue":".*","current":{"selected":true,"text":["All"],"value":["$__all"]},"datasource":{"type":"prometheus","uid":"prometheus"},"definition":"label_values(container_network_receive_bytes_total{namespace=~\"$namespace\"},pod)","hide":0,"includeAll":true,"multi":true,"name":"pod","options":[],"query":{"query":"label_values(container_network_receive_bytes_total{namespace=~\"$namespace\"},pod)","refId":"Prometheus-pod-Variable-Query"},"refresh":1,"regex":"","skipUrlSync":false,"sort":0,"tagValuesQuery":"","tagsQuery":"","type":"query","useTags":false},{"current":{"selected":false,"text":"","value":""},"hide":0,"name":"search","options":[{"selected":true,"text":"","value":""}],"query":"","skipUrlSync":false,"type":"textbox"}]},"time":{"from":"now-30m","to":"now"},"timepicker":{"refresh_intervals":["5s","10s","30s","1m","5m","15m","30m","1h","2h","1d"]},"timezone":"","title":"Loki Dashboard","uid":"liz0yRCZzwer","version":1,"weekStart":""}
      unifi-poller:
        USG-Insights:
          gnetId: 11313
          revision: 8
          datasource: prometheus
        USW-Insights:
          gnetId: 11312
          revision: 8
          datasource: prometheus
        UAP-Insights:
          gnetId: 11314
          revision: 9
          datasource: prometheus
        Client-Insights:
          gnetId: 11315
          revision: 8
          datasource: prometheus
        Network-Sites:
          gnetId: 11311
          revision: 4
          datasource: prometheus
        Client-DPI:
          gnetId: 11310
          revision: 4
          datasource: prometheus
      ingress-nginx:
        Kubernetes-Nginx-Ingress-Controller:
          gnetId: 14314
          revision: 2
          datasource: prometheus
        NGINX-Ingress-Controller:
          url: https://raw.githubusercontent.com/kubernetes/ingress-nginx/main/deploy/grafana/dashboards/nginx.json
          datasource: prometheus
        Request-Handling-Performance:
          url: https://raw.githubusercontent.com/kubernetes/ingress-nginx/main/deploy/grafana/dashboards/request-handling-performance.json
          datasource: prometheus
      pi-hole:
        PI-Hole-Exporter:
          url: https://raw.githubusercontent.com/eko/pihole-exporter/master/grafana/dashboard.json
          datasource: prometheus
      calico:
        Felix-Dashboard:
          gnetId: 12175
          revision: 5
          datasource: prometheus
        Kubernetes-Calico:
          json: |
            {"annotations":{"list":[{"builtIn":1,"datasource":{"type":"grafana","uid":"-- Grafana --"},"enable":true,"hide":true,"iconColor":"rgba(0, 211, 255, 1)","name":"Annotations & Alerts","target":{"limit":100,"matchAny":false,"tags":[],"type":"dashboard"},"type":"dashboard"}]},"description":"Calico cluster monitoring dashboard","editable":true,"fiscalYearStartMonth":0,"gnetId":3244,"graphTooltip":0,"id":18,"links":[],"liveNow":false,"panels":[{"collapsed":false,"datasource":{"type":"prometheus","uid":"prometheus"},"gridPos":{"h":1,"w":24,"x":0,"y":0},"id":15,"panels":[],"targets":[{"datasource":{"type":"prometheus","uid":"prometheus"},"refId":"A"}],"title":"Felix","type":"row"},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":{"type":"prometheus","uid":"prometheus"},"fill":1,"fillGradient":0,"gridPos":{"h":7,"w":12,"x":0,"y":1},"hiddenSeries":false,"id":1,"legend":{"alignAsTable":true,"avg":true,"current":true,"max":true,"min":true,"show":true,"total":false,"values":true},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","options":{"alertThreshold":true},"percentage":false,"pluginVersion":"9.1.6","pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"datasource":{"type":"prometheus","uid":"prometheus"},"expr":"felix_active_local_endpoints","format":"time_series","intervalFactor":2,"legendFormat":"{{instance}}","refId":"A","step":20}],"thresholds":[],"timeRegions":[],"title":"Active Local Endpoints","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"mode":"time","show":true,"values":[]},"yaxes":[{"format":"short","logBase":1,"show":true},{"format":"short","logBase":1,"show":true}],"yaxis":{"align":false}},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":{"type":"prometheus","uid":"prometheus"},"fill":1,"fillGradient":0,"gridPos":{"h":7,"w":12,"x":12,"y":1},"hiddenSeries":false,"id":3,"legend":{"alignAsTable":true,"avg":true,"current":true,"max":true,"min":true,"show":true,"total":false,"values":true},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","options":{"alertThreshold":true},"percentage":false,"pluginVersion":"9.1.6","pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"datasource":{"type":"prometheus","uid":"prometheus"},"expr":"felix_active_local_policies","format":"time_series","intervalFactor":2,"legendFormat":"{{instance}}","refId":"A","step":20}],"thresholds":[],"timeRegions":[],"title":"Active Local Policies","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"mode":"time","show":true,"values":[]},"yaxes":[{"format":"short","logBase":1,"show":true},{"format":"short","logBase":1,"show":true}],"yaxis":{"align":false}},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":{"type":"prometheus","uid":"prometheus"},"fill":1,"fillGradient":0,"gridPos":{"h":7,"w":12,"x":0,"y":8},"hiddenSeries":false,"id":2,"legend":{"alignAsTable":true,"avg":true,"current":true,"max":true,"min":true,"show":true,"total":false,"values":true},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","options":{"alertThreshold":true},"percentage":false,"pluginVersion":"9.1.6","pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"datasource":{"type":"prometheus","uid":"prometheus"},"expr":"felix_active_local_selectors","format":"time_series","intervalFactor":2,"legendFormat":"{{instance}}","refId":"A","step":20}],"thresholds":[],"timeRegions":[],"title":"Active Local Selectors","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"mode":"time","show":true,"values":[]},"yaxes":[{"format":"short","logBase":1,"show":true},{"format":"short","logBase":1,"show":true}],"yaxis":{"align":false}},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":{"type":"prometheus","uid":"prometheus"},"fill":1,"fillGradient":0,"gridPos":{"h":7,"w":12,"x":12,"y":8},"hiddenSeries":false,"id":4,"legend":{"alignAsTable":true,"avg":true,"current":true,"max":true,"min":true,"show":true,"total":false,"values":true},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","options":{"alertThreshold":true},"percentage":false,"pluginVersion":"9.1.6","pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"datasource":{"type":"prometheus","uid":"prometheus"},"expr":"felix_active_local_tags","format":"time_series","intervalFactor":2,"legendFormat":"{{instance}}","refId":"A","step":20}],"thresholds":[],"timeRegions":[],"title":"Active Local Tags","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"mode":"time","show":true,"values":[]},"yaxes":[{"format":"short","logBase":1,"show":true},{"format":"short","logBase":1,"show":true}],"yaxis":{"align":false}},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":{"type":"prometheus","uid":"prometheus"},"fill":1,"fillGradient":0,"gridPos":{"h":7,"w":12,"x":0,"y":15},"hiddenSeries":false,"id":5,"legend":{"alignAsTable":true,"avg":true,"current":true,"max":true,"min":true,"show":true,"total":false,"values":true},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","options":{"alertThreshold":true},"percentage":false,"pluginVersion":"9.1.6","pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"datasource":{"type":"prometheus","uid":"prometheus"},"expr":"felix_cluster_num_host_endpoints","format":"time_series","intervalFactor":2,"legendFormat":"{{instance}}","refId":"A","step":20}],"thresholds":[],"timeRegions":[],"title":"Cluster Host Endpoints","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"mode":"time","show":true,"values":[]},"yaxes":[{"format":"short","logBase":1,"show":true},{"format":"short","logBase":1,"show":true}],"yaxis":{"align":false}},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":{"type":"prometheus","uid":"prometheus"},"fill":1,"fillGradient":0,"gridPos":{"h":7,"w":12,"x":12,"y":15},"hiddenSeries":false,"id":6,"legend":{"alignAsTable":true,"avg":false,"current":true,"max":true,"min":true,"show":true,"total":false,"values":true},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","options":{"alertThreshold":true},"percentage":false,"pluginVersion":"9.1.6","pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"datasource":{"type":"prometheus","uid":"prometheus"},"expr":"felix_cluster_num_workload_endpoints","format":"time_series","intervalFactor":2,"legendFormat":"{{instance}}","refId":"A","step":20}],"thresholds":[],"timeRegions":[],"title":"Cluster Workload Endpoints","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"mode":"time","show":true,"values":[]},"yaxes":[{"format":"short","logBase":1,"show":true},{"format":"short","logBase":1,"show":true}],"yaxis":{"align":false}},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":{"type":"prometheus","uid":"prometheus"},"fill":1,"fillGradient":0,"gridPos":{"h":7,"w":12,"x":0,"y":22},"hiddenSeries":false,"id":7,"legend":{"alignAsTable":true,"avg":true,"current":true,"max":true,"min":true,"show":true,"total":false,"values":true},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","options":{"alertThreshold":true},"percentage":false,"pluginVersion":"9.1.6","pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"datasource":{"type":"prometheus","uid":"prometheus"},"expr":"felix_cluster_num_hosts","format":"time_series","intervalFactor":2,"legendFormat":"{{instance}}","refId":"A","step":20}],"thresholds":[],"timeRegions":[],"title":"Clusters Hosts","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"mode":"time","show":true,"values":[]},"yaxes":[{"format":"short","logBase":1,"show":true},{"format":"short","logBase":1,"show":true}],"yaxis":{"align":false}},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":{"type":"prometheus","uid":"prometheus"},"fill":1,"fillGradient":0,"gridPos":{"h":7,"w":12,"x":12,"y":22},"hiddenSeries":false,"id":8,"legend":{"alignAsTable":true,"avg":true,"current":true,"max":true,"min":true,"show":true,"total":false,"values":true},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","options":{"alertThreshold":true},"percentage":false,"pluginVersion":"9.1.6","pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"datasource":{"type":"prometheus","uid":"prometheus"},"expr":"felix_ipsets_calico","format":"time_series","intervalFactor":2,"legendFormat":"{{instance}}","refId":"A","step":20}],"thresholds":[],"timeRegions":[],"title":"Active IP Sets","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"mode":"time","show":true,"values":[]},"yaxes":[{"format":"short","logBase":1,"show":true},{"format":"short","logBase":1,"show":true}],"yaxis":{"align":false}},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":{"type":"prometheus","uid":"prometheus"},"fill":1,"fillGradient":0,"gridPos":{"h":7,"w":12,"x":0,"y":29},"hiddenSeries":false,"id":9,"legend":{"alignAsTable":true,"avg":true,"current":true,"max":true,"min":true,"show":true,"total":false,"values":true},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","options":{"alertThreshold":true},"percentage":false,"pluginVersion":"9.1.6","pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"datasource":{"type":"prometheus","uid":"prometheus"},"expr":"felix_iptables_chains","format":"time_series","intervalFactor":2,"legendFormat":"{{instance}}","refId":"A","step":20}],"thresholds":[],"timeRegions":[],"title":"Active IP Tables Chains","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"mode":"time","show":true,"values":[]},"yaxes":[{"format":"short","logBase":1,"show":true},{"format":"short","logBase":1,"show":true}],"yaxis":{"align":false}},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":{"type":"prometheus","uid":"prometheus"},"fill":1,"fillGradient":0,"gridPos":{"h":7,"w":12,"x":12,"y":29},"hiddenSeries":false,"id":10,"legend":{"alignAsTable":true,"avg":true,"current":true,"max":true,"min":true,"show":true,"total":false,"values":true},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","options":{"alertThreshold":true},"percentage":false,"pluginVersion":"9.1.6","pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"datasource":{"type":"prometheus","uid":"prometheus"},"expr":"felix_ipset_errors","format":"time_series","intervalFactor":2,"legendFormat":"{{instance}}","refId":"A","step":20}],"thresholds":[],"timeRegions":[],"title":"IP Set Command Failures","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"mode":"time","show":true,"values":[]},"yaxes":[{"format":"short","logBase":1,"show":true},{"format":"short","logBase":1,"show":true}],"yaxis":{"align":false}},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":{"type":"prometheus","uid":"prometheus"},"fill":1,"gridPos":{"h":7,"w":12,"x":0,"y":36},"id":11,"legend":{"alignAsTable":true,"avg":true,"current":true,"max":true,"min":true,"show":true,"total":false,"values":true},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"datasource":{"type":"prometheus","uid":"prometheus"},"expr":"felix_iptables_save_errors","format":"time_series","intervalFactor":2,"legendFormat":"{{instance}}","refId":"A","step":20}],"thresholds":[],"title":"IP Tables Save Errors","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"mode":"time","show":true,"values":[]},"yaxes":[{"format":"short","logBase":1,"show":true},{"format":"short","logBase":1,"show":true}]},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":{"type":"prometheus","uid":"prometheus"},"fill":1,"gridPos":{"h":7,"w":12,"x":12,"y":36},"id":12,"legend":{"alignAsTable":true,"avg":true,"current":true,"max":true,"min":true,"show":true,"total":false,"values":true},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"datasource":{"type":"prometheus","uid":"prometheus"},"expr":"felix_iptables_restore_errors","format":"time_series","intervalFactor":2,"legendFormat":"{{instance}}","refId":"A","step":20}],"thresholds":[],"title":"IP Tables Restore Errors","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"mode":"time","show":true,"values":[]},"yaxes":[{"format":"short","logBase":1,"show":true},{"format":"short","logBase":1,"show":true}]},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":{"type":"prometheus","uid":"prometheus"},"fill":1,"gridPos":{"h":7,"w":12,"x":0,"y":43},"id":13,"legend":{"alignAsTable":true,"avg":true,"current":true,"max":true,"min":true,"show":true,"total":false,"values":true},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"datasource":{"type":"prometheus","uid":"prometheus"},"expr":"felix_resyncs_started","format":"time_series","intervalFactor":2,"legendFormat":"{{instance}}","refId":"A","step":20}],"thresholds":[],"title":"Felix Resyncing Datastore","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"mode":"time","show":true,"values":[]},"yaxes":[{"format":"short","logBase":1,"show":true},{"format":"short","logBase":1,"show":true}]},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":{"type":"prometheus","uid":"prometheus"},"fill":1,"gridPos":{"h":7,"w":12,"x":12,"y":43},"id":14,"legend":{"alignAsTable":true,"avg":true,"current":true,"max":true,"min":true,"show":true,"total":false,"values":true},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","percentage":false,"pointradius":5,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"datasource":{"type":"prometheus","uid":"prometheus"},"expr":"felix_int_dataplane_failures","format":"time_series","intervalFactor":2,"legendFormat":"{{instance}}","refId":"A","step":20}],"thresholds":[],"title":"Dataplane failed updates","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"mode":"time","show":true,"values":[]},"yaxes":[{"format":"short","logBase":1,"show":true},{"format":"short","logBase":1,"show":true}]}],"refresh":false,"schemaVersion":37,"style":"dark","tags":["calico"],"templating":{"list":[]},"time":{"from":"now-6h","to":"now"},"timepicker":{"refresh_intervals":["5s","10s","30s","1m","5m","15m","30m","1h","2h","1d"],"time_options":["5m","15m","1h","6h","12h","24h","2d","7d","30d"]},"timezone":"","title":"Kubernetes Calico","uid":"z6JQXGNVk","version":1,"weekStart":""}
      cert-manager:
        cert-manager-dashboard:
          json: |
            {"__inputs":[],"__requires":[{"type":"grafana","id":"grafana","name":"Grafana","version":"6.3.4"},{"type":"panel","id":"graph","name":"Graph","version":""},{"type":"datasource","id":"prometheus","name":"Prometheus","version":"1.0.0"},{"type":"panel","id":"singlestat","name":"Singlestat","version":""},{"type":"panel","id":"table","name":"Table","version":""}],"annotations":{"list":[{"builtIn":1,"datasource":"-- Grafana --","enable":true,"hide":true,"iconColor":"rgba(0, 211, 255, 1)","name":"Annotations & Alerts","type":"dashboard"}]},"description":"Monitors Kubernetes deployments in cluster using Prometheus. Shows overall cluster CPU / Memory of deployments, replicas in each deployment. Uses Kube state metrics and cAdvisor metrics (741)","editable":true,"gnetId":11001,"graphTooltip":0,"id":null,"iteration":1571233502297,"links":[],"panels":[{"collapsed":false,"gridPos":{"h":1,"w":24,"x":0,"y":0},"id":18,"panels":[],"title":"Certificates","type":"row"},{"columns":[],"datasource":{"type":"prometheus","uid":"$datasource"},"fontSize":"100%","gridPos":{"h":8,"w":12,"x":0,"y":1},"id":15,"options":{},"pageSize":null,"pluginVersion":"6.3.4","scroll":true,"showHeader":true,"sort":{"col":0,"desc":true},"styles":[{"alias":"Time","dateFormat":"YYYY-MM-DD HH:mm:ss","pattern":"Time","type":"hidden"},{"alias":"Time Left","colorMode":"cell","colors":["rgba(245, 54, 54, 0.9)","rgba(237, 129, 40, 0.89)","rgba(50, 172, 45, 0.97)"],"decimals":2,"pattern":"Value","thresholds":["2592000","5184000","7776000"],"type":"number","unit":"dtdurations"},{"alias":"Certificate","colorMode":null,"colors":["rgba(245, 54, 54, 0.9)","rgba(237, 129, 40, 0.89)","rgba(50, 172, 45, 0.97)"],"dateFormat":"YYYY-MM-DD HH:mm:ss","decimals":2,"mappingType":1,"pattern":"Metric","thresholds":[],"type":"string","unit":"short"}],"targets":[{"expr":"sort_desc( sum(certmanager_certificate_expiration_timestamp_seconds{exported_namespace=~\"$Namespace\"} - time()) BY (name,exported_namespace) )","instant":true,"legendFormat":" {{exported_namespace}} / {{name}}","refId":"A"}],"timeFrom":null,"timeShift":null,"title":"Time Left","transform":"timeseries_to_rows","type":"table"},{"aliasColors":{},"bars":false,"cacheTimeout":null,"dashLength":10,"dashes":false,"datasource":{"type":"prometheus","uid":"$datasource"},"fill":0,"fillGradient":0,"gridPos":{"h":8,"w":12,"x":12,"y":1},"id":13,"legend":{"alignAsTable":false,"avg":false,"current":false,"max":false,"min":false,"rightSide":true,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"links":[],"nullPointMode":"null","options":{"dataLinks":[]},"percentage":false,"pointradius":2,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"sum(certmanager_certificate_ready_status) BY (condition)","format":"time_series","intervalFactor":2,"legendFormat":"{{condition}}","refId":"A","step":1800}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"Certificate Ready Status","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"short","label":null,"logBase":1,"max":null,"min":"0","show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":{"type":"prometheus","uid":"$datasource"},"fill":0,"fillGradient":0,"gridPos":{"h":8,"w":24,"x":0,"y":9},"id":16,"legend":{"avg":false,"current":false,"max":false,"min":false,"rightSide":true,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"nullPointMode":"null","options":{"dataLinks":[]},"percentage":false,"pluginVersion":"6.3.4","pointradius":2,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"sum(certmanager_certificate_expiration_timestamp_seconds{exported_namespace=~\"$Namespace\"} - time()) BY (name,exported_namespace)","instant":false,"intervalFactor":1,"legendFormat":" {{exported_namespace}} / {{name}}","refId":"A"}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"Time Left","tooltip":{"shared":true,"sort":1,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"decimals":2,"format":"s","label":null,"logBase":1,"max":"7776000","min":"0","show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}},{"collapsed":false,"gridPos":{"h":1,"w":24,"x":0,"y":17},"id":20,"panels":[],"title":"ACME Client","type":"row"},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":{"type":"prometheus","uid":"$datasource"},"fill":1,"fillGradient":0,"gridPos":{"h":8,"w":20,"x":0,"y":18},"id":22,"legend":{"avg":false,"current":false,"max":false,"min":false,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"nullPointMode":"null","options":{"dataLinks":[]},"percentage":false,"pointradius":2,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"sum(rate(certmanager_http_acme_client_request_count[2m])) BY (status)","legendFormat":"{{status}}","refId":"A"}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"Overall requests per 2m","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}},{"cacheTimeout":null,"colorBackground":false,"colorValue":false,"colors":["#299c46","rgba(237, 129, 40, 0.89)","#d44a3a"],"datasource":{"type":"prometheus","uid":"$datasource"},"format":"none","gauge":{"maxValue":100,"minValue":0,"show":false,"thresholdLabels":false,"thresholdMarkers":true},"gridPos":{"h":8,"w":4,"x":20,"y":18},"id":26,"interval":null,"links":[],"mappingType":1,"mappingTypes":[{"name":"value to text","value":1},{"name":"range to text","value":2}],"maxDataPoints":100,"nullPointMode":"connected","nullText":null,"options":{},"postfix":"","postfixFontSize":"50%","prefix":"","prefixFontSize":"50%","rangeMaps":[{"from":"null","text":"N/A","to":"null"}],"sparkline":{"fillColor":"rgba(31, 118, 189, 0.18)","full":false,"lineColor":"rgb(31, 120, 193)","show":false,"ymax":null,"ymin":null},"tableColumn":"","targets":[{"expr":"sum(certmanager_http_acme_client_request_count)","instant":true,"refId":"A"}],"thresholds":"","timeFrom":null,"timeShift":null,"title":"Total requests","type":"singlestat","valueFontSize":"80%","valueMaps":[{"op":"=","text":"N/A","value":"null"}],"valueName":"avg"},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":{"type":"prometheus","uid":"$datasource"},"fill":1,"fillGradient":0,"gridPos":{"h":8,"w":8,"x":0,"y":26},"id":24,"legend":{"avg":false,"current":false,"max":false,"min":false,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"nullPointMode":"null","options":{"dataLinks":[]},"percentage":false,"pointradius":2,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"sum(rate(certmanager_http_acme_client_request_count{path=\"/directory\"}[2m])) BY (status)","legendFormat":"{{status}}","refId":"A"}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"/directory","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":{"type":"prometheus","uid":"$datasource"},"fill":1,"fillGradient":0,"gridPos":{"h":8,"w":8,"x":8,"y":26},"id":27,"legend":{"avg":false,"current":false,"max":false,"min":false,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"nullPointMode":"null","options":{"dataLinks":[]},"percentage":false,"pointradius":2,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"sum(rate(certmanager_http_acme_client_request_count{path=\"/acme/cert\"}[2m])) BY (status)","legendFormat":"{{status}}","refId":"A"}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"/acme/cert","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":{"type":"prometheus","uid":"$datasource"},"fill":1,"fillGradient":0,"gridPos":{"h":8,"w":8,"x":16,"y":26},"id":28,"legend":{"avg":false,"current":false,"max":false,"min":false,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"nullPointMode":"null","options":{"dataLinks":[]},"percentage":false,"pointradius":2,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"sum(rate(certmanager_http_acme_client_request_count{path=\"/acme/new-acct\"}[2m])) BY (status)","legendFormat":"{{status}}","refId":"A"}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"/acme/new-acct","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":{"type":"prometheus","uid":"$datasource"},"fill":1,"fillGradient":0,"gridPos":{"h":8,"w":8,"x":0,"y":34},"id":29,"legend":{"avg":false,"current":false,"max":false,"min":false,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"nullPointMode":"null","options":{"dataLinks":[]},"percentage":false,"pointradius":2,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"sum(rate(certmanager_http_acme_client_request_count{path=\"/acme/order\"}[2m])) BY (status)","legendFormat":"{{status}}","refId":"A"}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"/acme/order","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":{"type":"prometheus","uid":"$datasource"},"fill":1,"fillGradient":0,"gridPos":{"h":8,"w":8,"x":8,"y":34},"id":30,"legend":{"avg":false,"current":false,"max":false,"min":false,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"nullPointMode":"null","options":{"dataLinks":[]},"percentage":false,"pointradius":2,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"sum(rate(certmanager_http_acme_client_request_count{path=\"/acme/new-order\"}[2m])) BY (status)","legendFormat":"{{status}}","refId":"A"}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"/acme/new-order","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":{"type":"prometheus","uid":"$datasource"},"fill":1,"fillGradient":0,"gridPos":{"h":8,"w":8,"x":16,"y":34},"id":31,"legend":{"avg":false,"current":false,"max":false,"min":false,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"nullPointMode":"null","options":{"dataLinks":[]},"percentage":false,"pointradius":2,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"sum(rate(certmanager_http_acme_client_request_count{path=\"/acme/authz-v3\"}[2m])) BY (status)","legendFormat":"{{status}}","refId":"A"}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"/acme/authz-v3","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":{"type":"prometheus","uid":"$datasource"},"fill":1,"fillGradient":0,"gridPos":{"h":8,"w":8,"x":0,"y":42},"id":32,"legend":{"avg":false,"current":false,"max":false,"min":false,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"nullPointMode":"null","options":{"dataLinks":[]},"percentage":false,"pointradius":2,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"sum(rate(certmanager_http_acme_client_request_count{path=\"/acme/chall-v3\"}[2m])) BY (status)","legendFormat":"{{status}}","refId":"A"}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"/acme/chall-v3","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":{"type":"prometheus","uid":"$datasource"},"fill":1,"fillGradient":0,"gridPos":{"h":8,"w":8,"x":8,"y":42},"id":33,"legend":{"avg":false,"current":false,"max":false,"min":false,"show":true,"total":false,"values":false},"lines":true,"linewidth":1,"nullPointMode":"null","options":{"dataLinks":[]},"percentage":false,"pointradius":2,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"expr":"sum(rate(certmanager_http_acme_client_request_count{path=\"/acme/finalize\"}[2m])) BY (status)","legendFormat":"{{status}}","refId":"A"}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"/acme/finalize","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true},{"format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}}],"refresh":false,"schemaVersion":19,"style":"dark","tags":["k8s"],"templating":{"list":[{"current":{"selected":false,"text":"default","value":"default"},"hide":0,"includeAll":false,"label":"Data Source","multi":false,"name":"datasource","options":[],"query":"prometheus","refresh":1,"regex":"","skipUrlSync":false,"type":"datasource"},{"current":{"isNone":true,"selected":false,"text":"None","value":""},"datasource":{"type":"prometheus","uid":"$datasource"},"definition":"","hide":2,"includeAll":false,"multi":false,"name":"cluster","options":[],"query":{"query":"label_values(up{job=\"kube-state-metrics\"}, cluster)","refId":"Prometheus-cluster-Variable-Query"},"refresh":2,"regex":"","skipUrlSync":false,"sort":1,"tagValuesQuery":"","tagsQuery":"","type":"query","useTags":false},{"allValue":".*","current":{},"datasource":{"type":"prometheus","uid":"$datasource"},"definition":"label_values(exported_namespace)","hide":0,"includeAll":true,"label":null,"multi":false,"name":"Namespace","options":[],"query":"label_values(exported_namespace)","refresh":1,"regex":"","skipUrlSync":false,"sort":0,"tagValuesQuery":"","tags":[],"tagsQuery":"","type":"query","useTags":false},{"allValue":".*","current":{},"datasource":{"type":"prometheus","uid":"$datasource"},"definition":"label_values(certmanager_certificate_expiration_timestamp_seconds{exported_namespace=~\"$Namespace\"},name) ","hide":0,"includeAll":true,"label":null,"multi":false,"name":"Certificate","options":[],"query":"label_values(certmanager_certificate_expiration_timestamp_seconds{exported_namespace=~\"$Namespace\"},name) ","refresh":2,"regex":"","skipUrlSync":false,"sort":0,"tagValuesQuery":"","tags":[],"tagsQuery":"","type":"query","useTags":false}]},"time":{"from":"now-24h","to":"now"},"timepicker":{"refresh_intervals":["5s","10s","30s","1m","5m","15m","30m","1h","2h","1d"],"time_options":["5m","15m","1h","6h","12h","24h","2d","7d","30d"]},"timezone":"browser","title":"cert-manager-dashboard","uid":"u6M5igpWk","version":5}
      velero:
        velero-dashboard:
          gnetId: 16829
          revision: 1
          datasource: prometheus
      longhorn:
        longhorn-dashboard:
          json: |
            {"annotations":{"list":[{"builtIn":1,"datasource":{"type":"datasource","uid":"grafana"},"enable":true,"hide":true,"iconColor":"rgba(0, 211, 255, 1)","name":"Annotations & Alerts","target":{"limit":100,"matchAny":false,"tags":[],"type":"dashboard"},"type":"dashboard"}]},"description":"An example dashboard for Longhorn. Updated by Robin Hermann (04.10.22)","editable":true,"fiscalYearStartMonth":0,"gnetId":16888,"graphTooltip":0,"id":22,"links":[],"liveNow":false,"panels":[{"collapsed":false,"datasource":{"type":"prometheus","uid":"${datasource}"},"gridPos":{"h":1,"w":24,"x":0,"y":0},"id":40,"panels":[],"title":"Volumes","type":"row"},{"datasource":{"type":"prometheus","uid":"${datasource}"},"description":"The total number of volumes in the Longhorn storage system","fieldConfig":{"defaults":{"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null}]}},"overrides":[]},"gridPos":{"h":6,"w":4,"x":0,"y":1},"id":8,"options":{"colorMode":"value","graphMode":"area","justifyMode":"auto","orientation":"auto","reduceOptions":{"calcs":["last"],"fields":"","values":false},"textMode":"auto"},"pluginVersion":"9.1.6","targets":[{"datasource":{"type":"prometheus","uid":"${datasource}"},"editorMode":"code","expr":"count(longhorn_volume_capacity_bytes{volume=~\"$volume\"}) OR on() vector(0)","interval":"","legendFormat":"","range":true,"refId":"A"}],"title":"Total Number Of Volumes","type":"stat"},{"datasource":{"type":"prometheus","uid":"${datasource}"},"description":"Healthy volumes are volumes that are attaching to a node and have the number of healthy replicas equals to the expected number of replicas.","fieldConfig":{"defaults":{"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"red","value":null},{"color":"green","value":1}]}},"overrides":[]},"gridPos":{"h":6,"w":4,"x":4,"y":1},"id":13,"options":{"colorMode":"value","graphMode":"area","justifyMode":"auto","orientation":"auto","reduceOptions":{"calcs":["last"],"fields":"","values":false},"textMode":"auto"},"pluginVersion":"9.1.6","targets":[{"datasource":{"type":"prometheus","uid":"${datasource}"},"editorMode":"code","expr":"count(longhorn_volume_robustness{volume=~\"$volume\"}==1) OR on() vector(0)","interval":"","legendFormat":"","range":true,"refId":"A"}],"title":"Number Of Healthy Volumes","type":"stat"},{"datasource":{"type":"prometheus","uid":"${datasource}"},"description":"Note that Longhorn volume actual size is not the size of the filesystem inside a Longhorn volume.  See more at : https://longhorn.io/docs/1.0.2/volumes-and-nodes/volume-size/#volume-actual-size","fieldConfig":{"defaults":{"color":{"mode":"palette-classic"},"custom":{"axisCenteredZero":false,"axisColorMode":"text","axisLabel":"","axisPlacement":"auto","barAlignment":0,"drawStyle":"line","fillOpacity":10,"gradientMode":"none","hideFrom":{"legend":false,"tooltip":false,"viz":false},"lineInterpolation":"smooth","lineWidth":1,"pointSize":5,"scaleDistribution":{"type":"linear"},"showPoints":"never","spanNulls":true,"stacking":{"group":"A","mode":"none"},"thresholdsStyle":{"mode":"line+area"}},"displayName":"${__field.labels.volume}","mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"transparent","value":null},{"color":"red","value":90}]},"unit":"percent"},"overrides":[]},"gridPos":{"h":9,"w":16,"x":8,"y":1},"id":12,"options":{"legend":{"calcs":["lastNotNull"],"displayMode":"table","placement":"right","showLegend":true,"sortBy":"Last *","sortDesc":true},"tooltip":{"mode":"multi","sort":"none"}},"pluginVersion":"8.4.2","targets":[{"datasource":{"type":"prometheus","uid":"${datasource}"},"editorMode":"code","exemplar":true,"expr":"( (avg by (volume) (longhorn_volume_actual_size_bytes{volume=~\"$volume\"}))/ (avg by (volume) (longhorn_volume_capacity_bytes{volume=~\"$volume\"})) ) *100","interval":"","legendFormat":"","range":true,"refId":"A"}],"title":"Volume Actual Size","type":"timeseries"},{"datasource":{"type":"prometheus","uid":"${datasource}"},"description":"Degraded volumes are volumes that have the number of healthy replicas smaller than the expected number of replicas. e.g. User creates a volume with 2 replicas but 1 replicas is failed.","fieldConfig":{"defaults":{"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null},{"color":"orange","value":1}]}},"overrides":[]},"gridPos":{"h":6,"w":4,"x":0,"y":7},"id":15,"options":{"colorMode":"value","graphMode":"area","justifyMode":"auto","orientation":"auto","reduceOptions":{"calcs":["last"],"fields":"","values":false},"textMode":"auto"},"pluginVersion":"9.1.6","targets":[{"datasource":{"type":"prometheus","uid":"${datasource}"},"editorMode":"code","expr":"count(longhorn_volume_robustness{volume=~\"$volume\"}==2) OR on() vector(0)","interval":"","legendFormat":"","range":true,"refId":"A"}],"title":"Number Of Degraded Volumes","type":"stat"},{"datasource":{"type":"prometheus","uid":"${datasource}"},"description":"Fault volumes are volumes that doesn't have any healthy replica.","fieldConfig":{"defaults":{"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null},{"color":"red","value":1}]}},"overrides":[]},"gridPos":{"h":6,"w":4,"x":4,"y":7},"id":16,"options":{"colorMode":"value","graphMode":"area","justifyMode":"auto","orientation":"auto","reduceOptions":{"calcs":["last"],"fields":"","values":false},"textMode":"auto"},"pluginVersion":"9.1.6","targets":[{"datasource":{"type":"prometheus","uid":"${datasource}"},"editorMode":"code","expr":"count(longhorn_volume_robustness{volume=~\"$volume\"}==3) OR on() vector(0)","interval":"","legendFormat":"","range":true,"refId":"A"}],"title":"Number Of Fault Volumes","type":"stat"},{"datasource":{"type":"prometheus","uid":"${datasource}"},"description":"The capacity of each Longhorn volume","fieldConfig":{"defaults":{"custom":{"align":"auto","displayMode":"auto","inspect":false},"decimals":1,"mappings":[{"options":{"":{"text":""}},"type":"value"}],"min":0,"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null},{"color":"#EAB839","value":75},{"color":"red","value":90}]},"unit":"bytes"},"overrides":[{"matcher":{"id":"byName","options":"Usage"},"properties":[{"id":"custom.displayMode","value":"lcd-gauge"}]},{"matcher":{"id":"byName","options":"Usage"},"properties":[{"id":"unit","value":"percent"},{"id":"min","value":0},{"id":"max","value":100}]}]},"gridPos":{"h":9,"w":16,"x":8,"y":10},"id":10,"options":{"footer":{"fields":"","reducer":["sum"],"show":false},"frameIndex":4,"showHeader":true,"sortBy":[{"desc":true,"displayName":"Usage"}]},"pluginVersion":"9.1.6","targets":[{"datasource":{"type":"prometheus","uid":"${datasource}"},"editorMode":"code","expr":"avg by (volume) (longhorn_volume_capacity_bytes{volume=~\"$volume\"})","format":"table","hide":false,"instant":true,"interval":"","intervalFactor":1,"legendFormat":"{{volume}}","refId":"capacity"},{"datasource":{"type":"prometheus","uid":"${datasource}"},"editorMode":"code","exemplar":false,"expr":"avg by (volume, name) (label_replace(kubelet_volume_stats_used_bytes, \"name\", \"$1\", \"persistentvolumeclaim\", \"(.*)\") * on(name) group_left(volume) (label_replace(kube_persistentvolume_claim_ref{persistentvolume=~\"$volume\"}, \"volume\", \"$1\", \"persistentvolume\", \"(.*)\")))","format":"table","hide":false,"instant":true,"legendFormat":"{{volume}}","range":false,"refId":"used"},{"datasource":{"type":"prometheus","uid":"${datasource}"},"editorMode":"code","exemplar":false,"expr":"100 / avg by (volume) (longhorn_volume_capacity_bytes{volume=~\"$volume\"})\r\n*\r\navg by (volume) (label_replace(kubelet_volume_stats_used_bytes, \"name\", \"$1\", \"persistentvolumeclaim\", \"(.*)\") * on(name) group_left(volume, persistentvolume) (label_replace(kube_persistentvolume_claim_ref{persistentvolume=~\"$volume\"}, \"volume\", \"$1\", \"persistentvolume\", \"(.*)\")))","format":"table","hide":false,"instant":true,"legendFormat":"{{volume}}","range":false,"refId":"usage-percentage"}],"title":"Volume Capacity","transformations":[{"id":"merge","options":{}},{"id":"organize","options":{"excludeByName":{"Time":true},"indexByName":{"Time":0,"Value #capacity":4,"Value #usage-percentage":5,"Value #used":3,"name":2,"volume":1},"renameByName":{"Value":"Capacity","Value #A":"Usage","Value #B":"Used","Value #capacity":"Capacity","Value #usage-percentage":"Usage","Value #used":"Used","name":"Persistent Volume Claim","volume":"Volume"}}}],"type":"table"},{"datasource":{"type":"prometheus","uid":"${datasource}"},"description":"Attached volumes are volumes that are currently attaching to a node","fieldConfig":{"defaults":{"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"red","value":null},{"color":"green","value":1}]}},"overrides":[]},"gridPos":{"h":6,"w":4,"x":0,"y":13},"id":34,"options":{"colorMode":"value","graphMode":"area","justifyMode":"auto","orientation":"auto","reduceOptions":{"calcs":["last"],"fields":"","values":false},"textMode":"auto"},"pluginVersion":"9.1.6","targets":[{"datasource":{"type":"prometheus","uid":"${datasource}"},"editorMode":"code","expr":"count(longhorn_volume_state{volume=~\"$volume\"}==2) OR on() vector(0)","interval":"","legendFormat":"","range":true,"refId":"A"}],"title":"Number Of Attached Volumes","type":"stat"},{"datasource":{"type":"prometheus","uid":"${datasource}"},"description":"Detached volumes are volumes that aren't currently attaching to a node","fieldConfig":{"defaults":{"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null},{"color":"yellow","value":1}]}},"overrides":[]},"gridPos":{"h":6,"w":4,"x":4,"y":13},"id":14,"options":{"colorMode":"value","graphMode":"area","justifyMode":"auto","orientation":"auto","reduceOptions":{"calcs":["last"],"fields":"","values":false},"textMode":"auto"},"pluginVersion":"9.1.6","targets":[{"datasource":{"type":"prometheus","uid":"${datasource}"},"editorMode":"code","expr":"count(longhorn_volume_state{volume=~\"$volume\"}==3) OR on() vector(0)","interval":"","legendFormat":"","range":true,"refId":"A"}],"title":"Number Of Detached Volumes","type":"stat"},{"collapsed":false,"datasource":{"type":"prometheus","uid":"${datasource}"},"gridPos":{"h":1,"w":24,"x":0,"y":19},"id":42,"panels":[],"title":"Nodes","type":"row"},{"datasource":{"type":"prometheus","uid":"${datasource}"},"description":"The total number of nodes in the Longhorn storage system","fieldConfig":{"defaults":{"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null}]}},"overrides":[]},"gridPos":{"h":6,"w":4,"x":0,"y":20},"id":18,"options":{"colorMode":"value","graphMode":"area","justifyMode":"auto","orientation":"auto","reduceOptions":{"calcs":["last"],"fields":"","values":false},"textMode":"auto"},"pluginVersion":"9.1.6","targets":[{"datasource":{"type":"prometheus","uid":"${datasource}"},"expr":"avg(longhorn_node_count_total) OR on() vector(0)","interval":"","legendFormat":"","refId":"A"}],"title":"Total Number Of Nodes","type":"stat"},{"datasource":{"type":"prometheus","uid":"${datasource}"},"description":"Disabled nodes are nodes that are disabled by the user.  When users disable a node, Longhorn will not use the node's storage for replica scheduling. Note that Longhorn can still attach a volume to disabled nodes because the actual data of the volume could be on a different node.","fieldConfig":{"defaults":{"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null},{"color":"yellow","value":1}]}},"overrides":[]},"gridPos":{"h":6,"w":4,"x":4,"y":20},"id":21,"options":{"colorMode":"value","graphMode":"area","justifyMode":"auto","orientation":"auto","reduceOptions":{"calcs":["last"],"fields":"","values":false},"textMode":"auto"},"pluginVersion":"9.1.6","targets":[{"datasource":{"type":"prometheus","uid":"${datasource}"},"expr":"count(longhorn_node_status{condition=\"allowScheduling\"}==0) OR on() vector(0)","interval":"","legendFormat":"","refId":"A"}],"title":"Number Of Disabled Nodes","type":"stat"},{"datasource":{"type":"prometheus","uid":"${datasource}"},"description":"","fieldConfig":{"defaults":{"color":{"mode":"palette-classic"},"custom":{"axisCenteredZero":false,"axisColorMode":"text","axisLabel":"","axisPlacement":"auto","barAlignment":0,"drawStyle":"line","fillOpacity":10,"gradientMode":"none","hideFrom":{"legend":false,"tooltip":false,"viz":false},"lineInterpolation":"smooth","lineWidth":1,"pointSize":5,"scaleDistribution":{"type":"linear"},"showPoints":"never","spanNulls":true,"stacking":{"group":"A","mode":"none"},"thresholdsStyle":{"mode":"off"}},"displayName":"${__field.labels.node}","mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null},{"color":"red","value":80}]},"unit":"percent"},"overrides":[]},"gridPos":{"h":10,"w":16,"x":8,"y":20},"id":24,"options":{"legend":{"calcs":["lastNotNull"],"displayMode":"table","placement":"right","showLegend":true},"tooltip":{"mode":"multi","sort":"none"}},"pluginVersion":"8.4.2","targets":[{"datasource":{"type":"prometheus","uid":"${datasource}"},"exemplar":true,"expr":"(longhorn_node_storage_usage_bytes/longhorn_node_storage_capacity_bytes) * 100","interval":"","legendFormat":"","refId":"A"}],"title":"Node Storage Usage","type":"timeseries"},{"datasource":{"type":"prometheus","uid":"${datasource}"},"description":"Schedulable nodes are nodes that Longhorn can use their storage for replica scheduling.","fieldConfig":{"defaults":{"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"red","value":null},{"color":"green","value":1}]}},"overrides":[]},"gridPos":{"h":6,"w":4,"x":0,"y":26},"id":20,"options":{"colorMode":"value","graphMode":"area","justifyMode":"auto","orientation":"auto","reduceOptions":{"calcs":["last"],"fields":"","values":false},"textMode":"auto"},"pluginVersion":"9.1.6","targets":[{"datasource":{"type":"prometheus","uid":"${datasource}"},"expr":"(count(longhorn_node_status{condition=\"schedulable\"}==1) OR on() vector(0)) - (count(longhorn_node_status{condition=\"allowScheduling\"}==0) OR on() vector(0))","interval":"","legendFormat":"","refId":"A"}],"title":"Number Of Schedulable Nodes","type":"stat"},{"datasource":{"type":"prometheus","uid":"${datasource}"},"description":"Failed Nodes are nodes that Longhorn cannot attach volumes to and cannot schedule replicas onto. e.g: when the nodes went down.","fieldConfig":{"defaults":{"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null},{"color":"red","value":1}]}},"overrides":[]},"gridPos":{"h":6,"w":4,"x":4,"y":26},"id":22,"options":{"colorMode":"value","graphMode":"area","justifyMode":"auto","orientation":"auto","reduceOptions":{"calcs":["last"],"fields":"","values":false},"textMode":"auto"},"pluginVersion":"9.1.6","targets":[{"datasource":{"type":"prometheus","uid":"${datasource}"},"expr":"(avg(longhorn_node_count_total) OR on() vector(0)) - (count(longhorn_node_status{condition=\"ready\"}==1) OR on() vector(0))","interval":"","legendFormat":"","refId":"A"}],"title":"Number Of Failed Nodes","type":"stat"},{"datasource":{"type":"prometheus","uid":"${datasource}"},"description":"","fieldConfig":{"defaults":{"custom":{"align":"auto","displayMode":"auto","inspect":false},"decimals":1,"mappings":[],"min":0,"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null}]},"unit":"bytes"},"overrides":[{"matcher":{"id":"byName","options":"Storage Capacity"},"properties":[{"id":"custom.displayMode","value":"lcd-gauge"}]}]},"gridPos":{"h":10,"w":16,"x":8,"y":30},"id":23,"options":{"footer":{"fields":"","reducer":["sum"],"show":false},"showHeader":true},"pluginVersion":"9.1.6","targets":[{"datasource":{"type":"prometheus","uid":"${datasource}"},"expr":"longhorn_node_storage_capacity_bytes","format":"table","instant":true,"interval":"","legendFormat":"{{node}}","refId":"A"}],"title":"Node Capacity","transformations":[{"id":"organize","options":{"excludeByName":{"Time":true,"__name__":true,"endpoint":true,"instance":true,"job":true,"namespace":true,"pod":false,"service":true},"indexByName":{"Time":0,"Value":10,"__name__":1,"container":3,"endpoint":4,"instance":5,"job":6,"namespace":7,"node":2,"pod":8,"service":9},"renameByName":{"Value":"Storage Capacity","pod":""}}}],"type":"table"},{"datasource":{"type":"prometheus","uid":"${datasource}"},"fieldConfig":{"defaults":{"color":{"mode":"palette-classic"},"custom":{"axisCenteredZero":false,"axisColorMode":"text","axisLabel":"","axisPlacement":"auto","barAlignment":0,"drawStyle":"line","fillOpacity":10,"gradientMode":"none","hideFrom":{"legend":false,"tooltip":false,"viz":false},"lineInterpolation":"smooth","lineWidth":1,"pointSize":5,"scaleDistribution":{"type":"linear"},"showPoints":"never","spanNulls":true,"stacking":{"group":"A","mode":"none"},"thresholdsStyle":{"mode":"off"}},"decimals":0,"displayName":"${__field.labels.node}","mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null},{"color":"red","value":80}]},"unit":"short"},"overrides":[]},"gridPos":{"h":8,"w":8,"x":0,"y":32},"id":26,"options":{"legend":{"calcs":[],"displayMode":"list","placement":"bottom","showLegend":true},"tooltip":{"mode":"multi","sort":"none"}},"pluginVersion":"8.4.2","targets":[{"datasource":{"type":"prometheus","uid":"${datasource}"},"exemplar":true,"expr":"count by (node) (longhorn_volume_state==2)","interval":"","legendFormat":"","refId":"A"}],"title":"Number of Volumes Per Node","type":"timeseries"},{"collapsed":true,"datasource":{"type":"prometheus","uid":"${datasource}"},"gridPos":{"h":1,"w":24,"x":0,"y":40},"id":44,"panels":[{"datasource":{"type":"prometheus","uid":"${datasource}"},"description":"The capacity of each Longhorn volume","fieldConfig":{"defaults":{"color":{"mode":"palette-classic"},"custom":{"axisCenteredZero":false,"axisColorMode":"text","axisLabel":"","axisPlacement":"auto","barAlignment":0,"drawStyle":"line","fillOpacity":10,"gradientMode":"none","hideFrom":{"legend":false,"tooltip":false,"viz":false},"lineInterpolation":"smooth","lineWidth":1,"pointSize":5,"scaleDistribution":{"type":"linear"},"showPoints":"never","spanNulls":true,"stacking":{"group":"A","mode":"none"},"thresholdsStyle":{"mode":"off"}},"displayName":"${__field.labels.disk}","mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"green"},{"color":"red","value":80}]},"unit":"percent"},"overrides":[]},"gridPos":{"h":10,"w":12,"x":0,"y":41},"id":32,"options":{"legend":{"calcs":["lastNotNull"],"displayMode":"table","placement":"right","showLegend":true},"tooltip":{"mode":"multi","sort":"none"}},"pluginVersion":"8.4.2","targets":[{"datasource":{"type":"prometheus","uid":"${datasource}"},"exemplar":true,"expr":"(longhorn_disk_usage_bytes/longhorn_disk_capacity_bytes)*100","interval":"","legendFormat":"","refId":"A"}],"title":"Disk Space Usage","type":"timeseries"},{"datasource":{"type":"prometheus","uid":"${datasource}"},"description":"","fieldConfig":{"defaults":{"custom":{"align":"auto","displayMode":"auto","inspect":false},"decimals":1,"mappings":[],"min":0,"thresholds":{"mode":"absolute","steps":[{"color":"green"}]},"unit":"bytes"},"overrides":[{"matcher":{"id":"byName","options":"Capacity"},"properties":[{"id":"custom.displayMode","value":"lcd-gauge"}]}]},"gridPos":{"h":10,"w":12,"x":12,"y":41},"id":33,"options":{"footer":{"fields":"","reducer":["sum"],"show":false},"showHeader":true},"pluginVersion":"9.1.5","targets":[{"datasource":{"type":"prometheus","uid":"${datasource}"},"expr":"longhorn_disk_capacity_bytes","format":"table","instant":true,"interval":"","legendFormat":"{{disk}}","refId":"A"}],"title":"Disk Capacity","transformations":[{"id":"organize","options":{"excludeByName":{"Time":true,"Value":false,"__name__":true,"disk":false,"endpoint":true,"instance":true,"job":true,"namespace":true,"pod":true,"service":true},"indexByName":{"Time":0,"Value":11,"__name__":1,"container":3,"disk":4,"endpoint":5,"instance":6,"job":7,"namespace":8,"node":2,"pod":9,"service":10},"renameByName":{"Value":"Capacity"}}}],"type":"table"}],"title":"Disks","type":"row"},{"collapsed":true,"datasource":{"type":"prometheus","uid":"${datasource}"},"gridPos":{"h":1,"w":24,"x":0,"y":41},"id":46,"panels":[{"datasource":{"type":"prometheus","uid":"${datasource}"},"description":"","fieldConfig":{"defaults":{"color":{"mode":"palette-classic"},"custom":{"axisCenteredZero":false,"axisColorMode":"text","axisLabel":"","axisPlacement":"auto","barAlignment":0,"drawStyle":"line","fillOpacity":10,"gradientMode":"none","hideFrom":{"legend":false,"tooltip":false,"viz":false},"lineInterpolation":"smooth","lineWidth":1,"pointSize":5,"scaleDistribution":{"type":"linear"},"showPoints":"never","spanNulls":true,"stacking":{"group":"A","mode":"none"},"thresholdsStyle":{"mode":"line+area"}},"decimals":0,"displayName":"${__field.labels.node}","mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"transparent"},{"color":"red","value":80}]},"unit":"percent"},"overrides":[]},"gridPos":{"h":10,"w":12,"x":0,"y":42},"id":36,"links":[],"options":{"legend":{"calcs":[],"displayMode":"list","placement":"bottom","showLegend":true},"tooltip":{"mode":"multi","sort":"none"}},"pluginVersion":"8.4.2","targets":[{"datasource":{"type":"prometheus","uid":"${datasource}"},"exemplar":true,"expr":"(longhorn_node_cpu_usage_millicpu / longhorn_node_cpu_capacity_millicpu) * 100","interval":"","legendFormat":"","refId":"A"}],"title":"Node CPU Usage","type":"timeseries"},{"datasource":{"type":"prometheus","uid":"${datasource}"},"description":"","fieldConfig":{"defaults":{"color":{"mode":"palette-classic"},"custom":{"axisCenteredZero":false,"axisColorMode":"text","axisLabel":"","axisPlacement":"auto","barAlignment":0,"drawStyle":"line","fillOpacity":10,"gradientMode":"none","hideFrom":{"legend":false,"tooltip":false,"viz":false},"lineInterpolation":"smooth","lineWidth":1,"pointSize":5,"scaleDistribution":{"type":"linear"},"showPoints":"never","spanNulls":true,"stacking":{"group":"A","mode":"none"},"thresholdsStyle":{"mode":"line+area"}},"decimals":0,"displayName":"${__field.labels.node}","mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"transparent"},{"color":"red","value":80}]},"unit":"percent"},"overrides":[]},"gridPos":{"h":10,"w":12,"x":12,"y":42},"id":38,"links":[],"options":{"legend":{"calcs":[],"displayMode":"list","placement":"bottom","showLegend":true},"tooltip":{"mode":"multi","sort":"none"}},"pluginVersion":"8.4.2","targets":[{"datasource":{"type":"prometheus","uid":"${datasource}"},"exemplar":true,"expr":"( longhorn_node_memory_usage_bytes / longhorn_node_memory_capacity_bytes ) * 100","interval":"","legendFormat":"","refId":"A"}],"title":"Node Memory Usage","type":"timeseries"},{"datasource":{"type":"prometheus","uid":"${datasource}"},"description":"Instance managers are pods that contains the engine and replica processes of Longhorn volumes. See more at https://longhorn.io/docs/1.0.2/concepts/#11-the-longhorn-manager-and-the-longhorn-engine ","fieldConfig":{"defaults":{"color":{"mode":"palette-classic"},"custom":{"axisCenteredZero":false,"axisColorMode":"text","axisLabel":"","axisPlacement":"auto","barAlignment":0,"drawStyle":"line","fillOpacity":10,"gradientMode":"none","hideFrom":{"legend":false,"tooltip":false,"viz":false},"lineInterpolation":"smooth","lineWidth":1,"pointSize":5,"scaleDistribution":{"type":"linear"},"showPoints":"never","spanNulls":true,"stacking":{"group":"A","mode":"none"},"thresholdsStyle":{"mode":"off"}},"decimals":0,"displayName":"${__field.labels.instance_manager}","mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"green"},{"color":"red","value":80}]},"unit":"milicpu"},"overrides":[]},"gridPos":{"h":10,"w":8,"x":0,"y":52},"id":28,"links":[],"options":{"legend":{"calcs":[],"displayMode":"list","placement":"bottom","showLegend":true},"tooltip":{"mode":"multi","sort":"none"}},"pluginVersion":"8.4.2","targets":[{"datasource":{"type":"prometheus","uid":"${datasource}"},"exemplar":true,"expr":"longhorn_instance_manager_cpu_usage_millicpu","interval":"","legendFormat":"","refId":"A"}],"title":"Instance Manager CPU Usage","type":"timeseries"},{"datasource":{"type":"prometheus","uid":"${datasource}"},"description":"Instance managers are pods that contains the engine and replica processes of Longhorn volumes. See more at https://longhorn.io/docs/1.0.2/concepts/#11-the-longhorn-manager-and-the-longhorn-engine ","fieldConfig":{"defaults":{"color":{"mode":"palette-classic"},"custom":{"axisCenteredZero":false,"axisColorMode":"text","axisLabel":"","axisPlacement":"auto","barAlignment":0,"drawStyle":"line","fillOpacity":10,"gradientMode":"none","hideFrom":{"legend":false,"tooltip":false,"viz":false},"lineInterpolation":"smooth","lineWidth":1,"pointSize":5,"scaleDistribution":{"type":"linear"},"showPoints":"never","spanNulls":true,"stacking":{"group":"A","mode":"none"},"thresholdsStyle":{"mode":"line+area"}},"decimals":0,"displayName":"${__field.labels.instance_manager}","mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"transparent"},{"color":"red","value":100}]},"unit":"percent"},"overrides":[]},"gridPos":{"h":10,"w":8,"x":8,"y":52},"id":30,"links":[],"options":{"legend":{"calcs":[],"displayMode":"list","placement":"bottom","showLegend":true},"tooltip":{"mode":"multi","sort":"none"}},"pluginVersion":"8.4.2","targets":[{"datasource":{"type":"prometheus","uid":"${datasource}"},"exemplar":true,"expr":"(longhorn_instance_manager_cpu_usage_millicpu/longhorn_instance_manager_cpu_requests_millicpu)*100","interval":"","legendFormat":"","refId":"A"}],"title":"Instance Manager CPU Used from Request","type":"timeseries"},{"datasource":{"type":"prometheus","uid":"${datasource}"},"description":"Instance managers are pods that contains the engine and replica processes of Longhorn volumes. See more at https://longhorn.io/docs/1.0.2/concepts/#11-the-longhorn-manager-and-the-longhorn-engine ","fieldConfig":{"defaults":{"color":{"mode":"palette-classic"},"custom":{"axisCenteredZero":false,"axisColorMode":"text","axisLabel":"","axisPlacement":"auto","barAlignment":0,"drawStyle":"line","fillOpacity":10,"gradientMode":"none","hideFrom":{"legend":false,"tooltip":false,"viz":false},"lineInterpolation":"smooth","lineWidth":1,"pointSize":5,"scaleDistribution":{"type":"linear"},"showPoints":"never","spanNulls":true,"stacking":{"group":"A","mode":"none"},"thresholdsStyle":{"mode":"off"}},"displayName":"${__field.labels.instance_manager}","mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"green"},{"color":"red","value":80}]},"unit":"bytes"},"overrides":[]},"gridPos":{"h":10,"w":8,"x":16,"y":52},"id":29,"links":[],"options":{"legend":{"calcs":[],"displayMode":"list","placement":"bottom","showLegend":true},"tooltip":{"mode":"multi","sort":"none"}},"pluginVersion":"8.4.2","targets":[{"datasource":{"type":"prometheus","uid":"${datasource}"},"exemplar":true,"expr":"longhorn_instance_manager_memory_usage_bytes","interval":"","legendFormat":"","refId":"A"}],"title":"Instance Manager Memory Usage","type":"timeseries"},{"datasource":{"type":"prometheus","uid":"${datasource}"},"description":"Longhorn manager pods manage the control plane of the Longhorn system. e.g. Volume scheduling, attaching, detaching, backup, etc,..","fieldConfig":{"defaults":{"color":{"mode":"palette-classic"},"custom":{"axisCenteredZero":false,"axisColorMode":"text","axisLabel":"","axisPlacement":"auto","barAlignment":0,"drawStyle":"line","fillOpacity":10,"gradientMode":"none","hideFrom":{"legend":false,"tooltip":false,"viz":false},"lineInterpolation":"smooth","lineWidth":1,"pointSize":5,"scaleDistribution":{"type":"linear"},"showPoints":"never","spanNulls":true,"stacking":{"group":"A","mode":"none"},"thresholdsStyle":{"mode":"off"}},"decimals":0,"displayName":"${__field.labels.manager}","mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"green"},{"color":"red","value":80}]},"unit":"milicpu"},"overrides":[]},"gridPos":{"h":9,"w":12,"x":0,"y":62},"id":2,"options":{"legend":{"calcs":[],"displayMode":"list","placement":"bottom","showLegend":true},"tooltip":{"mode":"multi","sort":"none"}},"pluginVersion":"8.4.2","targets":[{"datasource":{"type":"prometheus","uid":"${datasource}"},"exemplar":true,"expr":"longhorn_manager_cpu_usage_millicpu","interval":"","legendFormat":"","refId":"A"}],"title":"Longhorn Manager CPU Usage","type":"timeseries"},{"datasource":{"type":"prometheus","uid":"${datasource}"},"description":"Longhorn manager pods manage the control plane of the Longhorn system. e.g. Volume scheduling, attaching, detaching, backup, etc,..","fieldConfig":{"defaults":{"color":{"mode":"palette-classic"},"custom":{"axisCenteredZero":false,"axisColorMode":"text","axisLabel":"","axisPlacement":"auto","barAlignment":0,"drawStyle":"line","fillOpacity":10,"gradientMode":"none","hideFrom":{"legend":false,"tooltip":false,"viz":false},"lineInterpolation":"smooth","lineWidth":1,"pointSize":5,"scaleDistribution":{"type":"linear"},"showPoints":"never","spanNulls":true,"stacking":{"group":"A","mode":"none"},"thresholdsStyle":{"mode":"off"}},"displayName":"${__field.labels.manager}","mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"green"},{"color":"red","value":80}]},"unit":"bytes"},"overrides":[]},"gridPos":{"h":9,"w":12,"x":12,"y":62},"id":31,"options":{"legend":{"calcs":[],"displayMode":"list","placement":"bottom","showLegend":true},"tooltip":{"mode":"multi","sort":"none"}},"pluginVersion":"8.4.2","targets":[{"datasource":{"type":"prometheus","uid":"${datasource}"},"exemplar":true,"expr":"longhorn_manager_memory_usage_bytes","interval":"","legendFormat":"","refId":"A"}],"title":"Longhorn Manager Memory Usage","type":"timeseries"}],"title":"CPU & Memory","type":"row"},{"collapsed":true,"gridPos":{"h":1,"w":24,"x":0,"y":42},"id":50,"panels":[{"datasource":{"type":"prometheus","uid":"${datasource}"},"description":"To get Longhorn Alerts you have to deploy PrometheusRules (more Infos: https://longhorn.io/docs/1.3.1/monitoring/alert-rules-example/)","gridPos":{"h":13,"w":24,"x":0,"y":82},"id":48,"options":{"alertInstanceLabelFilter":"","alertName":"Longhorn","dashboardAlerts":false,"datasource":"prometheus","groupBy":[],"groupMode":"default","maxItems":20,"sortOrder":1,"stateFilter":{"error":true,"firing":true,"noData":false,"normal":false,"pending":true}},"title":"Longhorn Alerts","type":"alertlist"}],"title":"Alerts","type":"row"}],"refresh":"5m","schemaVersion":37,"style":"dark","tags":["Storage","K8s","Longhorn"],"templating":{"list":[{"current":{"selected":true,"text":"Prometheus","value":"Prometheus"},"hide":0,"includeAll":false,"label":"Datasource","multi":false,"name":"datasource","options":[],"query":"prometheus","queryValue":"","refresh":1,"regex":"","skipUrlSync":false,"type":"datasource"},{"current":{},"datasource":{"type":"prometheus","uid":"${datasource}"},"definition":"label_values(longhorn_volume_state,volume)","hide":0,"includeAll":true,"label":"Volume","multi":true,"name":"volume","options":[],"query":{"query":"label_values(longhorn_volume_state,volume)","refId":"StandardVariableQuery"},"refresh":2,"regex":"","skipUrlSync":false,"sort":1,"type":"query"}]},"time":{"from":"now-6h","to":"now"},"timepicker":{"refresh_intervals":["5s","10s","30s","1m","5m","15m","30m","1h","2h","1d"]},"timezone":"","title":"Longhorn-Dashboard","uid":"2BCgsldGz","version":1,"weekStart":""}

        # custom-dashboard:
        #   file: dashboards/custom-dashboard.json
        # prometheus-stats:
        #   gnetId: 2
        #   revision: 2
        #   datasource: Prometheus
        # local-dashboard:
        #   url: https://example.com/repository/test.json
        #   token: ''
        # local-dashboard-base64:
        #   url: https://example.com/repository/test-b64.json
        #   token: ''
        #   b64content: true
        # local-dashboard-gitlab:
        #   url: https://example.com/repository/test-gitlab.json
        #   gitlabToken: ''
        # local-dashboard-bitbucket:
        #   url: https://example.com/repository/test-bitbucket.json
        #   bearerToken: ''

    grafana.ini:
      server:
        root_url: https://grafana.local.tecno-fly.com
      # auth.generic_oauth:
      #   enabled: true
      #   allow_sign_up: true
      #   name: Dex
      #   client_id: grafana-sso
      #   client_secret: $__env{GRAFANA_SSO_CLIENT_SECRET}
      #   scopes: openid profile email groups
      #   auth_url: https://dex.khuedoan.com/auth
      #   token_url: https://dex.khuedoan.com/token
      #   api_url: https://dex.khuedoan.com/userinfo

  kubeControllerManager:
    enabled: true

    endpoints:
      - 192.168.30.10
      - 192.168.30.20
      - 192.168.30.21

    service:
      enabled: true
      port: 10257
      targetPort: 10257

    serviceMonitor:
      enabled: true
      https: true
      insecureSkipVerify: true

  kubeScheduler:
    enabled: true

    endpoints:
      - 192.168.30.10
      - 192.168.30.20
      - 192.168.30.21

    service:
      enabled: true
      port: 10259
      targetPort: 10259

    serviceMonitor:
      enabled: true
      https: true
      insecureSkipVerify: true

  kubeProxy:
    enabled: true

    endpoints:
      - 192.168.30.10
      - 192.168.30.20
      - 192.168.30.21

    service:
      enabled: true
      port: 10249
      targetPort: 10249

    serviceMonitor:
      enabled: true
      https: false

  prometheus:
    enabled: true

    ingress:
      enabled: true

      ingressClassName: nginx

      annotations:
        cert-manager.io/cluster-issuer: letsencrypt-staging
        # kubernetes.io/tls-acme: "true"
        # hajimari.io/appName: Prometheus
        # hajimari.io/icon: chart-bar
      hosts:
        - prometheus.local.tecno-fly.com
      paths:
        - /
      tls: 
        - secretName: prometheus-tls
          hosts:
            - prometheus.local.tecno-fly.com

    prometheusSpec:
      ruleSelectorNilUsesHelmValues: false
      serviceMonitorSelectorNilUsesHelmValues: false
      serviceMonitorSelector:
        matchExpressions:
        - key: app
          operator: In
          values:
          - kube-prometheus-stack-kube-proxy
        # matchLabels:
        #   k8s-app: kube-proxy
      podMonitorSelectorNilUsesHelmValues: false
      probeSelectorNilUsesHelmValues: false
      storageSpec:
        volumeClaimTemplate:
          spec:
            storageClassName: longhorn
            resources:
              requests:
                storage: 50Gi
      # additionalScrapeConfigs:
      #   - job_name: 'unifipoller'
      #     scrape_interval: 30s
      #     static_configs:
      #     - targets: ['unifi-poller.monitoring-system.svc.cluster.local:9130']
